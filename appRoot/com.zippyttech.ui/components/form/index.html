<div class="row">
    <div class="{{db.classCol()}}">
        <form role="form" [formGroup]="_form" [hidden]="_search">
            <div *ngFor="let key of _keysForm">
                <div *ngIf="!_fnContainsType(key,'object') || (_fnContainsType(key,'object') && _getRule(key).model.permissions.search); else
                                                                                                                                            accessUnauthorized">
                    <div class="form-group input-icon right">
                        <div [hidden]="_fnHiddenFormControl(_getRule(key))">
                            <div class="row" *ngIf="!_fnContainsType(key,'image')">

                                <div class="{{ _getActionsRule(_getRule(key)).length?db.classCol(10,10,10,10):db.classCol()}}">
                                    <div class="input-group input-icon right">

                                        <i class="{{_getRule(key).icon}} z-index"></i>

                                        <span class="input-group-addon">
                                            {{'field.'+key+'.title' | translate}}
                                            <label *ngIf="_getRule(key).required" class="text-red">&nbsp;*</label>
                                        </span>

                                        <div *ngIf="!_getList(key); else
                                                                                inList">

                                            <ng-template
                                                    [ngIf]="_fnContainsType(key,'text','number','email','password')">
                                                <input class="form-control"
                                                       formControlName="{{key}}"
                                                       placeholder="{{'field.'+key+'.placeholder' | translate}}"
                                                       type="{{_getRule(key).type}}"
                                                       [readonly]="_getRule(key).readOnly"
                                                >
                                            </ng-template>

                                            <ng-template [ngIf]="_fnContainsType(key,'object')">
                                                <ng-template [ngIf]="_getRule(key).mode == 'reference'">
                                                    <input class="form-control"
                                                           formControlName="{{key}}"
                                                           placeholder="{{'field.'+key+'.placeholder' | translate}}"
                                                           type="text"
                                                           [readonly]="_getRule(key).readOnly"
                                                    >
                                                </ng-template>
                                            </ng-template>

                                            <!--<ng-template [ngIf]="_fnContainsType(key,'list')">-->
                                            <!--<input tags-input-->
                                            <!--type="text"-->
                                            <!--[prefix]="_getRule(key).model?_getRule(key).model.prefix:'GLOBAL_'"-->
                                            <!--formControlName="{{key}}"-->
                                            <!--(instance)="_getRule(key).instance?(_getRule(key).instance=$event||null):null"-->
                                            <!--&gt;-->
                                            <!--<ng-template [ngIf]="_getRule(key).inputFree">-->
                                            <!--<form (submit)="addTagManual($event,key)">-->
                                            <!--<input [attr.placeholder]="'custom.tagFree' | translate"-->
                                            <!--type="text"-->
                                            <!--[attr.aria-describedby]="key"-->
                                            <!--class="form-control">-->
                                            <!--</form>-->
                                            <!--</ng-template>-->
                                            <!--</ng-template>-->

                                            <ng-template [ngIf]="_fnContainsType(key,'color')">
                                                <input color-picker class="form-control"
                                                       [hexControl]="_getControl(key)" readonly>
                                            </ng-template>

                                            <ng-template [ngIf]="_fnContainsType(key,'textarea')">
                                                <textarea class="form-control"
                                                          formControlName="{{key}}"
                                                          rows="{{db.getParams('TEXTAREA_ROWS',_getRule(key).rows)}}"
                                                          formControlName="{{key}}"
                                                          placeholder="{{'field.'+key+'.placeholder' | translate}}"
                                                          [readonly]="_getRule(key).readOnly">

                                                </textarea>
                                            </ng-template>

                                            <ng-template [ngIf]="_fnContainsType(key,'combodate')">
                                                <input class="form-control"
                                                       formControlName="{{key}}"
                                                       placeholder="{{'field.'+key+'.placeholder' | translate}}"
                                                       [readonly]="_getRule(key).readOnly"
                                                       [rule]="_getRule(key)"
                                                       input-mask
                                                >
                                            </ng-template>

                                            <ng-template [ngIf]="_fnContainsType(key,'url')">
                                                <input class="form-control"
                                                       formControlName="{{key}}"
                                                       placeholder="{{'field.'+key+'.placeholder' | translate}}"
                                                       [readonly]="_getRule(key).readOnly"
                                                       [rule]="_getRule(key)"
                                                       input-mask>
                                            </ng-template>

                                            <ng-template [ngIf]="_fnContainsType(key,'select','boolean')">
                                                <select sm-dropdown formControlName="{{key}}"
                                                        class="ui fluid search selection dropdown">
                                                    <option value="-1">
                                                        {{( ('field.'+key+'.placeholder' || 'custom.selectOption') |
                                                        translate) }}
                                                    </option>
                                                    <option *ngFor="let n of _getRule(key).source"
                                                            [attr.value]="n.value"
                                                            [selected]="getFormValue(key)==n.value">
                                                        <i *ngIf="_getRule(key).icon" class="{{n.value}}">&nbsp;</i>
                                                        {{n.text}}
                                                    </option>
                                                </select>
                                            </ng-template>
                                        </div>

                                        <ng-template #inList>
                                            <input tags-input type="text"
                                                   [model]="model" [key]="key"
                                                   [control]="_getControl(key)">

                                            <ng-template [ngIf]="_getRule(key).list.inputFree">
                                                <form (submit)="_fnAddTagManual($event,key)">
                                                    <input [attr.placeholder]="'custom.tagFree' | translate"
                                                           type="text" class="form-control">
                                                </form>
                                            </ng-template>
                                        </ng-template>


                                        <div [hidden]="_getControl(key).valid || !_getControl(key).touched"
                                             class="alert alert-danger">
                                            <div *ngFor="let error of _getKeys(_getControl(key).errors || {})">
                                                {{ (('error.'+error) |
                                                translate:{params:_getControl(key).errors[error]}) }}
                                            </div>
                                        </div>

                                    </div>
                                </div>

                                <ng-template [ngIf]="_getActionsRule(_getRule(key)).length">
                                    <div class="{{db.classCol(2,2,2,2)}}">
                                        <div class="data-actions notHidden">
                                            <div class="btn-group dropdown">
                                                <button tabindex="-1" type="button" data-toggle="dropdown"
                                                        class="btn btn-box-tool dropdown-toggle" aria-haspopup="true"
                                                        aria-expanded="false">
                                                    <i class="fa fa-gears fa-lg"></i>
                                                </button>
                                                <ul role="menu" class="dropdown-menu text-left submenu-config">
                                                    <li *ngFor="let action of _getActionsRule(_getRule(key))"
                                                        (click)="action.callback(this,key);">
                                                        <a class="cursor-pointer {{action.currentView(this).colorClass || ''}}">
                                                            <i class="{{action.currentView(this).icon || ''}}"></i>
                                                            &nbsp;{{action.currentView(this).title || ''}}
                                                        </a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </ng-template>

                                <!--<div class="{{db.classCol(12,12,12,12)}} table-responsive"-->
                                <!--*ngIf="_getRule(key).type=='list' && dataListMultiple && dataListMultiple[key] && dataListMultiple[key].view">-->
                                <!--<table class="table table-striped table-hover">-->
                                <!--<tbody>-->
                                <!--<tr *ngFor="let data of dataListMultiple[key].data">-->
                                <!--<td>{{data}}</td>-->
                                <!--<td>-->
                                <!--<button (click)="deleteListMultiple($event,key,data)"-->
                                <!--class="btn btn-box-tool fa fa-trash text-red"-->
                                <!--[attr.title]="db.msg*.delete"></button>-->
                                <!--</td>-->
                                <!--</tr>-->
                                <!--</tbody>-->
                                <!--</table>-->
                                <!--</div>-->
                            </div>

                            <div class="row padding-bottom-4" *ngIf="_fnContainsType(key,'image')">
                                <div class="col-lg-10 col-lg-offset-1">
                                    <image-edit-view [default]="_getRule(key).default"
                                                     (out)="saveImage($event,key)"
                                    >
                                    </image-edit-view>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <ng-template #accessUnauthorized>
                    <i class="fa fa-warning text-red"></i>&nbsp;
                    {{ ('custom.accessUnauthorized' | translate:{code:model.prefix+'_SEARCH'}) }}
                </ng-template>
            </div>
        </form>
        <ng-template [ngIf]="_search">
            <search-view [params]="_search" (output)="_onEventSearch($event)"></search-view>
        </ng-template>
        <div class="{{db.classCol()}}" *ngIf="!_search">
            <p [innerHtml]="'custom.fieldRequired' | translate"></p>
        </div>
    </div>
</div>
